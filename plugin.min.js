(function(e,c,a,g){var d="timerangewheel",f={width:240,height:240,margin:{top:20,left:20,bottom:20,right:20},offset:80,indicatorWidth:12,accentColor:"#d81b60",handleRadius:14,handleStrokeWidth:2,handleStrokeColor:"#ffffff",handleIconColor:"#333333",handleFillColorStart:"#ffffff",handleFillColorEnd:"#d81b60",rangeTotal:24,tickColor:"#f9f9f9",indicatorBackgroundColor:"#d3d3d3"};function b(i,h){this.element=i;this.settings=e.extend({},f,h);this._defaults=f;this._name=d;this.init()}e.extend(b.prototype,{graph:{svg:{},pie:{},arc:{}},helper:{settings:{},graphdata:[],calculateTime:function(j){var l=j<0?"-":"";var k=Math.floor(Math.abs(j));var i=Math.floor((Math.abs(j)*60)%60);return l+(k<10?"0":"")+k+":"+(i<10?"0":"")+(i-(i%5))},calculateTimeFromMinutes:function(j){var h=Math.floor(j/60);var i=j%60;return(h<10?"0":"")+h+":"+(i<10?"0":"")+i},calculateDuration:function(j,h){var k;var i=d3.scale.linear().range([0,288]).domain([0,360]);k=i(h)-i(j);if(k<0){k=288+k}return this.calculateTimeFromMinutes(k*5)},createTimeInfoObject:function(m){var i=d3.scale.linear().range([0,288]).domain([0,360]);var k,h,j,l,n;j=this.calculateTimeFromMinutes(i(m.aAngle)*5);l=this.calculateTimeFromMinutes(i(m.eAngle)*5);n=this.calculateDuration(m.aAngle,m.eAngle);return{start:j,end:l,duration:n}},calculateKnobInitialData:function(n){var h,l,j,o=0,k=0,m=0;var i=d3.scale.linear().range([0,360]).domain([0,this.settings.rangeTotal]);var p=d3.scale.linear().range([0,360]).domain([0,288]);j=n.start.split(":");m=j[0]*12;m+=(j[1]*1)/5;k=p(m);o=i.invert(k);this.graphdata.push({value:o,label:"a",angle:k});j=n.end.split(":");m=j[0]*12;m+=(j[1]*1)/5;k=p(m);o=i.invert(k);this.graphdata.push({value:o,label:"e",angle:k})},calculateKnobUpdateHandleData:function(k){var o,h,l,k=0,n=0,m=0;var i=d3.scale.linear().range([0,360]).domain([0,this.settings.rangeTotal]);var j=d3.scale.linear().range([0,360]).domain([0,288]);l=initialData.start.split(":");m=l[0]*12;m+=(l[1]*1)/5;n=j(m);k=i.invert(n);this.graphdata.push({value:k,label:"a",angle:n});l=initialData.end.split(":");m=l[0]*12;m+=(l[1]*1)/5;n=j(m);k=i.invert(n);this.graphdata.push({value:k,label:"e",angle:n})},getValueOfDataSet:function(h){var i=0;this.graphdata.forEach(function(k,j){if(k.label==h){i=k.value}});return i},getAngleOfDataSet:function(h){var i=0;this.graphdata.forEach(function(k,j){if(k.label==h){i=k.angle}});return i},getData:function(){return this.graphdata}},init:function(){var A=this;var q,t,j,h,n;var E,D,B,x;var r=null;var i=d3.scale.linear().range([0,360]).domain([0,this.settings.rangeTotal]);var m=d3.scale.linear().range([0,360]).domain([0,288]);var v=this.settings.height,y=this.settings.width,u=this.settings.margin;var l=(Math.min(y,v)-u.top-u.bottom)/2;var z=l+this.settings.indicatorWidth/2;var p=z-this.settings.indicatorWidth;var k=function(K,H){var I=d3.select(this).classed("active",true);var J=d3.mouse(A.graph.svg.node());var F=J[0]-l;var M=J[1]-l;var G;var L=(Math.atan2(M,F)*180/Math.PI)+90;if(L<0){L=360+L}L=L-((L*100)%125)/100;K.value=i.invert(L);K.angle=L.toFixed(2);if(K.angle!=r){r=K.angle;C(I);s(K.label)}};var o=function(N,H,M,J){var L=d3.selectAll("#handles .handlercontainer");var I=0;var K=0;var G=0;var F;L.each(function(P,O){if(P.label=="a"){I=P.angle}if(P.label=="e"){K=P.angle}});if(I*1>K*1){I=(I*1)-360}A.graph.arc=d3.svg.arc().innerRadius(p).outerRadius(z).startAngle(function(O){return I*(Math.PI/180)}).endAngle(function(O){return K*(Math.PI/180)});j.attr("d",A.graph.arc)};var w=function(){var F=h.selectAll(".handlercontainer").data(A.helper.getData());var G=F.enter().append("g").attr("class","handlercontainer").on("mouseover",function(){d3.select(this).classed("active",true)}).on("mouseout",function(){d3.select(this).classed("active",false)}).call(n);G.append("circle").attr({r:A.settings.handleRadius,"class":"handle"}).attr("stroke",A.settings.handleStrokeColor).attr("stroke-width",A.settings.handleStrokeWidth).attr("cursor","all-scroll").attr("fill",function(I,H){if(I.label=="a"){return A.settings.handleFillColorStart}else{return A.settings.handleFillColorEnd}}).attr("id",function(H){return H.label}).on("mouseover",function(){d3.select(this).classed("active",true)}).on("mouseout",function(){d3.select(this).classed("active",false)});F.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-family","FontAwesome").attr("font-size","1em").attr("cursor","all-scroll").attr("fill",A.settings.handleIconColor).text(function(H){if(H.label=="a"){return"\uf054"}else{return"\uf053"}});F.attr({transform:function(H){return"rotate("+i(H.value)+") translate(0,"+l*-1+")"}})};var C=function(F){F.attr({transform:function(H,G){o(H.value,G,H.label,H.angle);return"rotate("+i(H.value)+") translate(0,"+l*-1+")"}})};var s=function(G){var H=h.selectAll(".handlercontainer");var I=0;var F={a:0,aAngle:0,e:0,eAngle:0};H.each(function(K,J){F[K.label]=K.value;F[K.label+"Angle"]=K.angle});A.writeTimeInfo(A.helper.createTimeInfoObject(F))};this.setSettings(this._defaults);e(this.element).empty();e(this.element).append(e("<div>").attr("class","knob"));this.helper.calculateKnobInitialData(this.settings.data);E=this.helper.getValueOfDataSet("a");D=this.helper.getValueOfDataSet("e");B=this.helper.getAngleOfDataSet("a");x=this.helper.getAngleOfDataSet("e");this.writeTimeInfo(A.helper.createTimeInfoObject({a:E,e:D,aAngle:B,eAngle:x}));this.graph.pie=d3.layout.pie().value(function(G,F){return G.value}).sort(null);this.graph.svg=d3.select(".knob").append("svg").attr({height:this.settings.height+this.settings.offset,width:this.settings.width+this.settings.offset}).append("g").attr("id","holder").attr("transform","translate("+(((this.settings.width+this.settings.offset)-this.settings.width)/2+u.top)+","+(((this.settings.height+this.settings.offset)-this.settings.height)/2+u.left)+")");q=this.graph.svg.append("g").attr("id","ringbgrd").attr("transform","translate("+l+","+l+")");q.append("circle").attr({r:l,"class":"ringbgrd","stroke-width":this.settings.indicatorWidth-2,stroke:this.settings.indicatorBackgroundColor,"stroke-dasharray":2,fill:"none"});t=this.graph.svg.append("g").attr("id","arcindicator");if(B*1>x*1){B=(B*1)-360}this.graph.arc=d3.svg.arc().innerRadius(p).outerRadius(z).startAngle(function(F){return B*(Math.PI/180)}).endAngle(function(F){return x*(Math.PI/180)});j=t.append("g").attr("class","arcindicator").attr("transform","translate("+((this.settings.width/2)-20)+","+((this.settings.height/2)-20)+")").append("path").attr("fill",function(G,F){return A.settings.accentColor}).attr("d",A.graph.arc);h=this.graph.svg.append("g").attr("id","handles").attr("transform","translate("+l+","+l+")");n=d3.behavior.drag().origin(function(F){return F}).on("drag",k).on("dragend",function(){d3.select(this).classed("active",false)});w();this.drawClockTicks()},drawClockTicks:function(){var m=this;var j=this.graph.svg;var o;var p=m.settings.height,h=m.settings.width,i=m.settings.margin;var n=(Math.min(h,p)-i.top-i.bottom)/2;var l=n+m.settings.indicatorWidth/2+13;var k=function(r){var q=360/288;return d3.range(0,288).map(function(s,t){return{angle:s*q,label:s%12?null:s/12}})};o=j.append("g").attr("id","ticks").attr("transform","translate("+n+","+n+")").selectAll("g").data(k).enter().append("g").attr("transform",function(q){return"rotate("+(q.angle-90)+")translate("+l+",0)"});o.append("line").attr("x1",1).attr("y1",0).attr("x2",function(q){if(q.label||q.angle==0){return 10}else{return 5}}).attr("y2",0).style("stroke",m.settings.tickColor);o.append("text").attr("x",5).attr("dy",".35em").attr("transform",function(q){return q.angle>180?"rotate(180)translate(-16)":"rotate(0)translate(7)"}).style("text-anchor",function(q){return q.angle>180?"end":null}).style("fill",m.settings.tickColor).style("font-size","10px").text(function(q){return q.label})},writeTimeInfo:function(h){if(typeof this.settings.onChange==="function"){this.settings.onChange(h)}},setSettings:function(h){this.helper.settings=this.settings}});e.fn[d]=function(h){if(!(this instanceof e)){e.extend(f,h)}return this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,h))}})}})(jQuery,window,document);